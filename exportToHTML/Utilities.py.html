<html>
<head>
<title>Utilities.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #7a7e85;}
.s4 { color: #6aab73;}
.s5 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#191a1c">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
Utilities.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">random</span>

<span class="s0">from </span><span class="s1">Agents</span><span class="s2">.</span><span class="s1">Agent </span><span class="s0">import </span><span class="s1">Agent</span>

<span class="s0">def </span><span class="s1">read_file_parameters</span><span class="s2">(</span><span class="s1">allowed_params</span><span class="s2">, </span><span class="s1">file_name</span><span class="s2">):</span>
    
    
    <span class="s3"># TODO : NOVO FORMATO DE CONFIGURAÇÃO EM MATRIZ</span>

    <span class="s1">allowed </span><span class="s2">= {</span><span class="s1">p</span><span class="s2">: </span><span class="s0">None for </span><span class="s1">p </span><span class="s0">in </span><span class="s1">allowed_params</span><span class="s2">}  </span><span class="s3"># Dict of allowed keys</span>

    <span class="s0">try</span><span class="s2">:</span>
        <span class="s0">with </span><span class="s1">open</span><span class="s2">(</span><span class="s1">file_name</span><span class="s2">, </span><span class="s4">&quot;r&quot;</span><span class="s2">) </span><span class="s0">as </span><span class="s1">f</span><span class="s2">:</span>
            <span class="s0">for </span><span class="s1">line </span><span class="s0">in </span><span class="s1">f</span><span class="s2">:</span>

                <span class="s3"># Clean and skip empty/comment lines</span>
                <span class="s1">line </span><span class="s2">= </span><span class="s1">line</span><span class="s2">.</span><span class="s1">strip</span><span class="s2">()</span>
                <span class="s0">if not </span><span class="s1">line </span><span class="s0">or </span><span class="s1">line</span><span class="s2">.</span><span class="s1">startswith</span><span class="s2">(</span><span class="s4">&quot;#&quot;</span><span class="s2">):</span>
                    <span class="s0">continue</span>

                <span class="s0">if </span><span class="s4">&quot;=&quot; </span><span class="s0">not in </span><span class="s1">line</span><span class="s2">:</span>
                    <span class="s0">raise </span><span class="s1">ValueError</span><span class="s2">(</span><span class="s4">f&quot;Invalid line (no '='): </span><span class="s0">{</span><span class="s1">line</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>

                <span class="s1">key</span><span class="s2">, </span><span class="s1">value </span><span class="s2">= </span><span class="s1">line</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s4">&quot;=&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
                <span class="s1">key </span><span class="s2">= </span><span class="s1">key</span><span class="s2">.</span><span class="s1">strip</span><span class="s2">()</span>

                <span class="s0">if </span><span class="s1">key </span><span class="s0">not in </span><span class="s1">allowed</span><span class="s2">:</span>
                    <span class="s0">raise </span><span class="s1">ValueError</span><span class="s2">(</span><span class="s4">f&quot;Unexpected parameter in file: '</span><span class="s0">{</span><span class="s1">key</span><span class="s0">}</span><span class="s4">'&quot;</span><span class="s2">)</span>

                <span class="s1">value </span><span class="s2">= </span><span class="s1">value</span><span class="s2">.</span><span class="s1">strip</span><span class="s2">()</span>

                <span class="s3"># Try to convert to int or float</span>
                <span class="s0">if </span><span class="s1">value</span><span class="s2">.</span><span class="s1">isdigit</span><span class="s2">():</span>
                    <span class="s1">value </span><span class="s2">= </span><span class="s1">int</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
                <span class="s0">else</span><span class="s2">:</span>
                    <span class="s0">try</span><span class="s2">:</span>
                        <span class="s1">value </span><span class="s2">= </span><span class="s1">float</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
                    <span class="s0">except </span><span class="s1">ValueError</span><span class="s2">:</span>
                        <span class="s0">pass  </span><span class="s3"># keep as string</span>

                <span class="s1">allowed</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">value</span>

    <span class="s0">except </span><span class="s1">FileNotFoundError</span><span class="s2">:</span>
        <span class="s0">raise </span><span class="s1">FileNotFoundError</span><span class="s2">(</span><span class="s4">f&quot;File '</span><span class="s0">{</span><span class="s1">file_name</span><span class="s0">}</span><span class="s4">' does not exist&quot;</span><span class="s2">)</span>

    <span class="s3"># Check for missing allowed parameters</span>
    <span class="s1">missing </span><span class="s2">= [</span><span class="s1">k </span><span class="s0">for </span><span class="s1">k</span><span class="s2">, </span><span class="s1">v </span><span class="s0">in </span><span class="s1">allowed</span><span class="s2">.</span><span class="s1">items</span><span class="s2">() </span><span class="s0">if </span><span class="s1">v </span><span class="s0">is None</span><span class="s2">]</span>
    <span class="s0">if </span><span class="s1">missing</span><span class="s2">:</span>
        <span class="s0">raise </span><span class="s1">ValueError</span><span class="s2">(</span><span class="s4">f&quot;Missing required parameters: </span><span class="s0">{</span><span class="s1">missing</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>

    <span class="s0">return </span><span class="s1">allowed</span>

<span class="s0">def </span><span class="s1">read_matrix_file_with_metadata</span><span class="s2">(</span><span class="s1">file_name</span><span class="s2">):</span>
    <span class="s1">ALLOWED_CHARS </span><span class="s2">= {</span><span class="s4">'.'</span><span class="s2">, </span><span class="s4">'E'</span><span class="s2">, </span><span class="s4">'N'</span><span class="s2">, </span><span class="s4">'S'</span><span class="s2">, </span><span class="s4">'W'</span><span class="s2">, </span><span class="s4">'F'</span><span class="s2">, </span><span class="s4">'C'</span><span class="s2">}</span>
    <span class="s1">matrix </span><span class="s2">= []</span>

    <span class="s0">try</span><span class="s2">:</span>
        <span class="s0">with </span><span class="s1">open</span><span class="s2">(</span><span class="s1">file_name</span><span class="s2">, </span><span class="s4">&quot;r&quot;</span><span class="s2">) </span><span class="s0">as </span><span class="s1">f</span><span class="s2">:</span>
            <span class="s0">for </span><span class="s1">line_number</span><span class="s2">, </span><span class="s1">line </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">f</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=</span><span class="s5">1</span><span class="s2">):</span>
                <span class="s1">line </span><span class="s2">= </span><span class="s1">line</span><span class="s2">.</span><span class="s1">strip</span><span class="s2">()</span>
                <span class="s0">if not </span><span class="s1">line</span><span class="s2">:</span>
                    <span class="s0">continue</span>

                <span class="s0">if </span><span class="s1">line</span><span class="s2">.</span><span class="s1">startswith</span><span class="s2">(</span><span class="s4">&quot;#&quot;</span><span class="s2">):</span>
                    <span class="s0">continue</span>

                <span class="s3"># Validate characters</span>
                <span class="s0">for </span><span class="s1">char </span><span class="s0">in </span><span class="s1">line</span><span class="s2">:</span>
                    <span class="s0">if </span><span class="s1">char </span><span class="s0">not in </span><span class="s1">ALLOWED_CHARS</span><span class="s2">:</span>
                        <span class="s0">raise </span><span class="s1">ValueError</span><span class="s2">(</span>
                            <span class="s4">f&quot;Invalid character '</span><span class="s0">{</span><span class="s1">char</span><span class="s0">}</span><span class="s4">' on line </span><span class="s0">{</span><span class="s1">line_number</span><span class="s0">}</span><span class="s4">&quot;</span>
                        <span class="s2">)</span>

                <span class="s1">matrix</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">list</span><span class="s2">(</span><span class="s1">line</span><span class="s2">))</span>

        <span class="s0">if not </span><span class="s1">matrix</span><span class="s2">:</span>
            <span class="s0">raise </span><span class="s1">ValueError</span><span class="s2">(</span><span class="s4">&quot;Matrix is empty&quot;</span><span class="s2">)</span>

        <span class="s3"># Ensure all rows are same length</span>
        <span class="s1">row_length </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">matrix</span><span class="s2">[</span><span class="s5">0</span><span class="s2">])</span>
        <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">row </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">matrix</span><span class="s2">, </span><span class="s1">start</span><span class="s2">=</span><span class="s5">1</span><span class="s2">):</span>
            <span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">row</span><span class="s2">) != </span><span class="s1">row_length</span><span class="s2">:</span>
                <span class="s0">raise </span><span class="s1">ValueError</span><span class="s2">(</span><span class="s4">f&quot;Row </span><span class="s0">{</span><span class="s1">i</span><span class="s0">} </span><span class="s4">has length </span><span class="s0">{</span><span class="s1">len</span><span class="s2">(</span><span class="s1">row</span><span class="s2">)</span><span class="s0">}</span><span class="s4">, expected </span><span class="s0">{</span><span class="s1">row_length</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>

        <span class="s0">return </span><span class="s1">matrix</span>

    <span class="s0">except </span><span class="s1">FileNotFoundError</span><span class="s2">:</span>
        <span class="s0">raise </span><span class="s1">FileNotFoundError</span><span class="s2">(</span><span class="s4">f&quot;File '</span><span class="s0">{</span><span class="s1">file_name</span><span class="s0">}</span><span class="s4">' does not exist&quot;</span><span class="s2">)</span>

<span class="s0">def </span><span class="s1">read_agent_config</span><span class="s2">(</span><span class="s1">file_name</span><span class="s2">: </span><span class="s1">str</span><span class="s2">) </span><span class="s1">-&gt; dict</span><span class="s2">:</span>
    <span class="s1">config </span><span class="s2">= {}</span>
    <span class="s0">try</span><span class="s2">:</span>
        <span class="s0">with </span><span class="s1">open</span><span class="s2">(</span><span class="s1">file_name</span><span class="s2">, </span><span class="s4">&quot;r&quot;</span><span class="s2">) </span><span class="s0">as </span><span class="s1">f</span><span class="s2">:</span>
            <span class="s0">for </span><span class="s1">line </span><span class="s0">in </span><span class="s1">f</span><span class="s2">:</span>
                <span class="s1">line </span><span class="s2">= </span><span class="s1">line</span><span class="s2">.</span><span class="s1">strip</span><span class="s2">()</span>
                <span class="s0">if not </span><span class="s1">line </span><span class="s0">or </span><span class="s1">line</span><span class="s2">.</span><span class="s1">startswith</span><span class="s2">(</span><span class="s4">&quot;#&quot;</span><span class="s2">):</span>
                    <span class="s0">continue</span>
                <span class="s0">if </span><span class="s4">&quot;=&quot; </span><span class="s0">not in </span><span class="s1">line</span><span class="s2">:</span>
                    <span class="s0">raise </span><span class="s1">ValueError</span><span class="s2">(</span><span class="s4">f&quot;Invalid line in config: </span><span class="s0">{</span><span class="s1">line</span><span class="s0">}</span><span class="s4">&quot;</span><span class="s2">)</span>
                <span class="s1">key</span><span class="s2">, </span><span class="s1">value </span><span class="s2">= </span><span class="s1">line</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s4">&quot;=&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">)</span>
                <span class="s1">config</span><span class="s2">[</span><span class="s1">key</span><span class="s2">.</span><span class="s1">strip</span><span class="s2">()] = </span><span class="s1">value</span><span class="s2">.</span><span class="s1">strip</span><span class="s2">()</span>
        <span class="s0">return </span><span class="s1">config</span>
    <span class="s0">except </span><span class="s1">FileNotFoundError</span><span class="s2">:</span>
        <span class="s0">raise </span><span class="s1">FileNotFoundError</span><span class="s2">(</span><span class="s4">f&quot;Agent config file '</span><span class="s0">{</span><span class="s1">file_name</span><span class="s0">}</span><span class="s4">' does not exist&quot;</span><span class="s2">)</span>
</pre>
</body>
</html>